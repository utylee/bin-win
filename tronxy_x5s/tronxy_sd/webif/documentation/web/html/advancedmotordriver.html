<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">


<!-- Mirrored from smoothieware.org/advancedmotordriver by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 May 2016 11:45:37 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <title>Advancedmotordriver - Smoothie Project</title>
    
    	<script type="text/javascript" src="login__customdomainscriptf36a.html?site_id=269117"></script>

    
    <script type="text/javascript" src="../images/init.combined.js"></script>
    <script  type="text/javascript">
        var URL_HOST = 'www.wikidot.com';
        var URL_DOMAIN = 'wikidot.com';
        var USE_SSL =  true ;
        var URL_STATIC = '../images/v--edac79f846ba';
        // global request information
        
        var WIKIREQUEST = {};
        WIKIREQUEST.info = {};
        
        WIKIREQUEST.info.domain = "smoothieware.org";
        WIKIREQUEST.info.siteId = 269117;
        WIKIREQUEST.info.siteUnixName = "chibidibidiwah";
        WIKIREQUEST.info.categoryId = 1474485;
        WIKIREQUEST.info.themeId = 256585;
        WIKIREQUEST.info.requestPageName = "advancedmotordriver";
        OZONE.request.timestamp = 1463138533;
        OZONE.request.date = new Date();
        WIKIREQUEST.info.lang = 'en';
                WIKIREQUEST.info.pageUnixName = "advancedmotordriver";
        WIKIREQUEST.info.pageId = 42811783;
                        WIKIREQUEST.info.lang = "en";
        OZONE.lang = "en";
        var isUAMobile = !!/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    </script>
    
    


    
        <script  type="text/javascript">
    
        require.config({
            baseUrl: URL_STATIC + '/common--javascript',
            paths: {
                'jquery.ui': 'jquery-ui.min',
                'jquery.form': 'jquery.form'
            }
        });
    
    </script>
    
    <meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
            
    
    
    
    
    <meta http-equiv="content-language" content="en"/>
    <script type="text/javascript" src="../images/wikidot.combined.js"></script>
            <script type="text/javascript" src="../images/bootstrap.min.js"></script>
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
             <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
        
        <link href="../images/font-awesome.min.css" rel="stylesheet">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
    
    <style type="text/css" id="internal-style">
        
        /* modules */
        
                /* bootstrap */
            @import url(../images/bootstrap.min.css);
                
        /* theme */
                    @import url(../images/style.css);
                    @import url(../images/style-2.css);
            </style>
    
            <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
          <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        
        
        
    <link rel="shortcut icon" href="../images/favicon.gif"/>
    <link rel="icon" type="image/gif" href="../images/favicon.gif"/>
    
            <link rel="apple-touch-icon" href="../images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png" />
        
        
            <link rel="alternate" type="application/wiki" title="Edit this page" href="javascript:WIKIDOT.page.listeners.editClick()"/>
    
        <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-18234656-1']);
        _gaq.push(['_setDomainName', 'none']);
        _gaq.push(['_setAllowLinker', true]);
        _gaq.push(['_trackPageview']);

        _gaq.push(['old._setAccount', 'UA-68540-5']);
        _gaq.push(['old._setDomainName', 'none']);
        _gaq.push(['old._setAllowLinker', true]);
        _gaq.push(['old._trackPageview']);

                _gaq.push(['userTracker._setAccount', 'UA-26338855-1']);
        _gaq.push(['userTracker._trackPageview']);
            </script>
    
    <script type="text/javascript">
        window.google_analytics_uacct = 'UA-18234656-1';
        window.google_analytics_domain_name = 'none';
    </script>
    
    </head>
<body id="html-body">
<div id="skrollr-body">
<!---------------------------------------------------------
  Standard Template Layout
  Developed by the Wikidot Community
  Version: 1.00.140723
---------------------------------------------------------->

<div class="container-wrap-wrap">
<div class="container-wrap">

<div class="container">
<header class="header-wrap" role="banner">
  
  <nav class="top-bar-wrap navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container top-bar">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-top-target">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html" style="display:none">Home</a>
      </div>
      <div class="collapse navbar-collapse navbar-top-target">

        <ul class="nav navbar-nav">
        

<ul class="nav navbar-nav">
<li><img src="../images/icon-firmware-48.png" alt="icon-firmware-48.png" class="image" /><br /></li>
<li><a href="index.html">Documentation</a><br /></li>
<li><img src="../images/icon-board-48.png" alt="icon-board-48.png" class="image" /><br /></li>
<li><a href="smoothieboard.html">SmoothieBoard</a><br /></li>
<li><img src="../images/icon-blog-48.png" alt="icon-blog-48.png" class="image" /><br /></li>
<li><a href="blog.html">Blog</a><br /></li>
<li><img src="../images/icon-gallery-48.png" alt="icon-gallery-48.png" class="image" /><br /></li>
<li><a href="gallery.html">Gallery</a><br /></li>
<li><img src="../images/icon-community-48.png" alt="icon-community-48.png" class="image" /><br /></li>
<li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Community</a><br />
<ul class="dropdown-menu">
<li><a href="irc.html">IRC : recommended (ﾉ◕ヮ◕)ﾉ*:･ﾟ✧</a></li>
<li><a href="general.html">Forum</a></li>
<li><a href="http://groups.google.com/group/smoothieware-support">Support/Help Mailing list</a></li>
<li><a href="http://groups.google.com/group/smoothie-dev">Developper Mailing list</a></li>
<li><a href="111870450664099533727.html">Google+ Community</a></li>
<li><a href="index-2.html">Facebook page</a></li>
</ul>
</li>
<li><img src="../images/icon-search-48.png" alt="icon-search-48.png" class="image" /><br /></li>
<li><a href="search.html">Search</a><br /></li>
</ul>
<div style="position:fixed; left: 10pt; bottom: -20pt"><img src="../images/smoothie-icon-small-78.png" alt="smoothie-icon-small-78.png" class="image" /></div>


        </ul>
      </div>
    </div>
  </nav>
  
  <div class="header-extra-div-1"><span></span></div>
  <div class="header-extra-div-2"><span></span></div>
  <div class="header-extra-div-3"><span></span></div>
</header>
</div>










 
<main class="content-wrap" role="main">
  <div class="container content">
    <div class="row">
    
      
      <div class="main-content-wrap col-md-12">
        <div class="main-content">
          <div class="page-title page-header" style="display:none"><span>Advancedmotordriver</span></div>
          
          <div id="page-content">

<h1 id="toc0"><span>Advanced Driver Chip Module</span></h1>
<p>This module is used to control SPI based stepper motor driver chips. Like the Panucatt Bigfoot series.</p>
<div class="bs-callout bs-callout-warning">
<p>Note that most of these drivers derive their power from Vbb (12v), not from the 3.3v, so in order to be setup correctly they need to be powered up before smoothie boots, this means the Vbb must be on before the 5v power comes on.<br />
Alternatively the Smoothieboard must be hard reset after power is on.</p>
</div>
<h2 id="toc1"><span>Config settings</span></h2>
<p>This module is enabled in config with:</p>
<div class="code">
<pre>
<code>motor_driver_control.motor1.enable true  # where motor1 is any name you wish</code>
</pre></div>
<p>the chip this controls is set with:</p>
<div class="code">
<pre>
<code>motor_driver_control.motor1.chip DRV8711    # this can be one of DRV8711 or TMC2660 The latter can control any TMC26x derivative</code>
</pre></div>
<p>The SPI channel to use must be set with:</p>
<div class="code">
<pre>
<code>motor_driver_control.motor1.spi_channel  0       # or 1
motor_driver_control.motor1.spi_cs_pin   0.10    # any pin
motor_driver_control.motor1.spi_frequency 100000 # the spi frequency to use</code>
</pre></div>
<p>other config settings:</p>
<div class="code">
<pre>
<code>motor_driver_control.motor1.designator  A   # for display purposes and for settin gin Mxxx commands
motor_driver_control.motor1.alarm         true  # enable alarm checking of chip, and report with a console message
motor_driver_control.motor1.halt_on_alarm true  # set to true to force a halt on any alarm condition
motor_driver_control.motor1.current       3000  # set the motor current in milliamps
motor_driver_control.motor1.max_current   4000  # the maximum cuurent the chip allows
motor_driver_control.motor1.microsteps    128   # the microsteps for this driver</code>
</pre></div>
<p>Some chip specific configs are&#8230;</p>
<div class="code">
<pre>
<code>motor_driver_control.motor1.sense_resistor  xxx  # set the sense resistor used, this value is chip specific, set top the default for commonly used drivers
motor_driver_control.motor1.gain  xxx  # set the gain for a DRV8711, leave at default if you do not know what this is
# direct register setting... order and codes are chip dependent, values are in 32 bit Hex
motor_driver_control.motor1.reg 00002,981C0,A0000,C000E,E0060</code>
</pre></div>
<p>An example of config entries is as follows, this sets two advanced drivers, one is a DRV8711 and the other is a TMC2660.</p>
<div class="code">
<pre>
<code>motor_driver_control.alpha.enable           true              # alpha (X) is a TMC26X
motor_driver_control.alpha.designator       A                 # A to set the settings
motor_driver_control.alpha.chip             TMC2660           # chip name
motor_driver_control.alpha.current          1500              # current in milliamps
motor_driver_control.alpha.max_current      2800              # max current in milliamps
motor_driver_control.alpha.microsteps       64                # microsteps
motor_driver_control.alpha.alarm            true              # set to true means the error bits are checked
motor_driver_control.alpha.halt_on_alarm    false             # if set to true means ON_HALT is entered on any error bits being set

motor_driver_control.alpha.spi_channel       1                # SPI channel 1 is sdcard channel
motor_driver_control.alpha.spi_cs_pin        0.10             # SPI CS pin
#motor_driver_control.alpha.spi_frequency     100000          # SPI frequency

motor_driver_control.beta.enable           true              # beta (Y) is a DRV8711
motor_driver_control.beta.designator       B                 # B to set the settings
motor_driver_control.beta.chip             DRV8711           # chip name
motor_driver_control.beta.current          4000              # current in milliamps
motor_driver_control.beta.max_current      4000              # max current in milliamps
motor_driver_control.beta.microsteps       64                # microsteps
motor_driver_control.beta.alarm            true              # set to true means the error bits are checked
motor_driver_control.beta.halt_on_alarm    false             # if set to true means ON_HALT is entered on any error bits being set
motor_driver_control.beta.spi_channel       1                # SPI channel 1 is sdcard channel
motor_driver_control.beta.spi_cs_pin        0.19!            # SPI CS pin DRV8711 requires inverted CS
#motor_driver_control.beta.spi_frequency     100000          # SPI frequency</code>
</pre></div>
<h2 id="toc2"><span>M code settings</span></h2>
<p>Many settings can be made on the fly with M codes, many if these are specific to certain chips:</p>
<ul>
<li>M911 will dump all the registers and status of all the motors</li>
<li>M911.1 Pn (or A0) will dump the registers and status of the selected motor. X0 will request format in processing machine readable format</li>
<li>M911.2 Pn (or B0) Rxxx Vyyy sets Register xxx to value yyy for motor nnn, xxx == 255 writes the registers, xxx == 0 shows what registers are mapped to what</li>
<li>M911.3 Pn (or C0) will set the options based on the parameters passed as below&#8230;
<ul>
<li>TMC2660:-
<ul>
<li>M911.3 Onnn Qnnn setStallGuardThreshold O=stall_guard_threshold, Q=stall_guard_filter_enabled</li>
<li>M911.3 Hnnn Innn Jnnn Knnn Lnnn setCoolStepConfiguration H=lower_SG_threshold, I=SG_hysteresis, J=current_decrement_step_size, K=current_increment_step_size, L=lower_current_limit</li>
<li>M911.3 S0 Unnn Vnnn Wnnn Xnnn Ynnn setConstantOffTimeChopper U=constant_off_time, V=blank_time, W=fast_decay_time_setting, X=sine_wave_offset, Y=use_current_comparator</li>
<li>M911.3 S1 Unnn Vnnn Wnnn Xnnn Ynnn setSpreadCycleChopper U=constant_off_time, V=blank_time, W=hysteresis_start, X=hysteresis_end, Y=hysteresis_decrement</li>
<li>M911.3 S2 Zn setRandomOffTime Z=on|off Z1 is on Z0 is off</li>
<li>M911.3 S3 Zn setDoubleEdge Z=on|off Z1 is on Z0 is off</li>
<li>M911.3 S4 Zn setStepInterpolation Z=on|off Z1 is on Z0 is off</li>
<li>M911.3 S5 Zn setCoolStepEnabled Z=on|off Z1 is on Z0 is off</li>
</ul>
</li>
<li>DRV8711: has none at the moment, just set the raw register.</li>
</ul>
</li>
</ul>
<ul>
<li>M906 Annn change current to nnn in milliamps for motor designator A</li>
<li>M909 Ann set microstepping for motor designator A tp 1/nn</li>
<li>M909.1 Annn set microstepping and also change steps/mm accordingly</li>
</ul>
<p>These are saved with M500 and override anything set in config.</p>
</div>
          
          <div style="height:150px"></div>
          <div class="page-info-break"></div>
          <div class="page-options-container"><div id="page-info">page revision: 8, last edited: <span class="odate time_1461969825 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%20%28%25O%20ago%29">29 Apr 2016 22:43</span></div>
            <div id="page-options-bottom"  class="page-options-bottom">
            <a href="javascript:;" class="btn btn-default" id="edit-button">Edit</a>
<a href="javascript:;" class="btn btn-default" id="tags-button">Tags</a>

<a href="javascript:;" class="btn btn-default" id="history-button">History</a>
<a href="javascript:;" class="btn btn-default" id="files-button">Files</a>
<a href="javascript:;" class="btn btn-default" id="print-button">Print</a>
<a href="javascript:;" class="btn btn-default" id="site-tools-button">Site tools</a>
<a href="javascript:;" class="btn btn-default" id="more-options-button">+&nbsp;Options</a> 
</div>
<div id="page-options-bottom-2" class="page-options-bottom form-actions" style="display:none">
    <a href="javascript:;" class="btn btn-default" id="edit-sections-button">Edit Sections</a>
    <a href="javascript:;" class="btn btn-default" id="edit-append-button">Append</a>
    <a href="javascript:;" class="btn btn-default" id="edit-meta-button">Edit Meta</a>
    <a href="javascript:;" class="btn btn-default" id="watchers-button">Watchers</a> 
    <a href="javascript:;" class="btn btn-default" id="backlinks-button">Backlinks</a> 
    <a href="javascript:;" class="btn btn-default" id="view-source-button">Page Source</a> 
    <a href="javascript:;" class="btn btn-default" id="parent-page-button">Parent</a> 
    <a href="javascript:;" class="btn btn-default" id="page-block-button">Lock Page</a>    
    <a href="javascript:;" class="btn btn-default" id="rename-move-button">Rename</a> 
    <a href="javascript:;" class="btn btn-default" id="delete-button">Delete</a> 
</div>
<div id="page-options-area-bottom">
</div>
</div>
          <div id="action-area" style="display: none;"></div>
        </div>
      </div>
    </div>
  </div>
</main>
 
<footer class="footer-wrap" role="contentinfo">
  <div class="container footer">
    <div class="options" style="display: block; visibility: visible;">
    <a href="http://www.wikidot.com/doc" id="wikidot-help-button">Help</a>
    &nbsp;|
    <a href="legal_terms-of-service.html" id="wikidot-tos-button">Terms of Service</a>
    &nbsp;|
    <a href="legal_privacy-policy.html" id="wikidot-privacy-button">Privacy</a>
    &nbsp;|
    <a href="javascript:;" id="bug-report-button" onclick="WIKIDOT.page.listeners.pageBugReport(event)">Report a bug</a>
    &nbsp;|
    <a href="javascript:;" id="abuse-report-button" onclick="WIKIDOT.page.listeners.flagPageObjectionable(event)">Flag as objectionable</a>
</div>
Powered by <a href="index-4.html">Wikidot.com</a> 
    <div class="license-area">Unless otherwise stated, the content of this page is licensed under <a rel="license" href="index-5.html">Creative Commons Attribution-ShareAlike 3.0 License</a></div>
  </div>
  <div class="extrac-div-1"><span></span></div>
  <div class="extrac-div-2"><span></span></div>
  <div class="extrac-div-3"><span></span></div>
</footer>
 

</div> <!-- container-wrap -->
 
<div class="extra-div-1"><span></span></div>
<div class="extra-div-2"><span></span></div>
<div class="extra-div-3"><span></span></div>
<div class="extra-div-4"><span></span></div>
<div class="extra-div-5"><span></span></div>
<div class="extra-div-6"><span></span></div>
</div> <!-- container-wrap-wrap -->
</div>
<div id="dummy-ondomready-block" style="display: none;" ></div>
    <!-- Google Analytics load -->
    <script type="text/javascript">
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

    <!-- Quantcast -->
    <script type="text/javascript">
    _qoptions={
        qacct:"p-edL3gsnUjJzw-"
    };
    (function() {
        var qc = document.createElement('script'); qc.type = 'text/javascript'; qc.async = true;
        qc.src = ('https:' == document.location.protocol ? 'https://secure' : 'http://edge') + '.quantserve.com/quant.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(qc, s);
    })();
    </script>
    <noscript>
        <img src="../images/p-edl3gsnujjzw-.gif" style="display: none;" border="0" height="1" width="1" alt="Quantcast"/>
    </noscript>




<div id="page-options-bottom-tips" style="display: none;">
    <div id="edit-button-hovertip">
        Click here to edit contents of this page.    </div>
</div>
<div id="page-options-bottom-2-tips"  style="display: none;">
    <div id="edit-sections-button-hovertip">
        Click here to toggle editing of individual sections of the page (if possible).         Watch headings for an &quot;edit&quot; link when available.    </div>
    <div id="edit-append-button-hovertip">
        Append content without editing the whole page source.    </div>
    <div id="history-button-hovertip">
        Check out how this page has evolved in the past.    </div>
    <div id="discuss-button-hovertip">
        If you want to discuss contents of this page - this is the easiest way to do it.    </div>
    <div id="files-button-hovertip">
        View and manage file attachments for this page.    </div>
    <div id="site-tools-button-hovertip">
        A few useful tools to manage this Site.    </div>
    <div id="backlinks-button-hovertip">
        See pages that link to and include this page.    </div>
    <div id="rename-move-button-hovertip">
        Change the name (also URL address, possibly the category) of the page.    </div>
    <div id="view-source-button-hovertip">
        View wiki source for this page without editing.    </div>
    <div id="parent-page-button-hovertip">  
        View/set parent page (used for creating breadcrumbs and structured layout).    </div>
            <div id="abuse-report-button-hovertip">
            Notify administrators if there is objectionable content in this page.        </div>
        <div id="bug-report-button-hovertip">
            Something does not work as expected? Find out what you can do.        </div>
        <div id="wikidot-help-button-hovertip">
            General Wikidot.com documentation and help section.        </div>
        <div id="wikidot-tos-button-hovertip">
            Wikidot.com Terms of Service - what you can, what you should not etc.        </div>
        <div id="wikidot-privacy-button-hovertip">
            Wikidot.com Privacy Policy.          
        </div>
    </div>
</body>

<!-- Mirrored from smoothieware.org/advancedmotordriver by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 May 2016 11:45:37 GMT -->
</html>