<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">


<!-- Mirrored from smoothieware.org/zprobe by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 May 2016 11:45:19 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <title>Zprobe - Smoothie Project</title>
    
    	<script type="text/javascript" src="login__customdomainscriptf36a.html?site_id=269117"></script>

    
    <script type="text/javascript" src="../images/init.combined.js"></script>
    <script  type="text/javascript">
        var URL_HOST = 'www.wikidot.com';
        var URL_DOMAIN = 'wikidot.com';
        var USE_SSL =  true ;
        var URL_STATIC = '../images/v--edac79f846ba';
        // global request information
        
        var WIKIREQUEST = {};
        WIKIREQUEST.info = {};
        
        WIKIREQUEST.info.domain = "smoothieware.org";
        WIKIREQUEST.info.siteId = 269117;
        WIKIREQUEST.info.siteUnixName = "chibidibidiwah";
        WIKIREQUEST.info.categoryId = 1474485;
        WIKIREQUEST.info.themeId = 256585;
        WIKIREQUEST.info.requestPageName = "zprobe";
        OZONE.request.timestamp = 1463138531;
        OZONE.request.date = new Date();
        WIKIREQUEST.info.lang = 'en';
                WIKIREQUEST.info.pageUnixName = "zprobe";
        WIKIREQUEST.info.pageId = 22043810;
                        WIKIREQUEST.info.lang = "en";
        OZONE.lang = "en";
        var isUAMobile = !!/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    </script>
    
    


    
        <script  type="text/javascript">
    
        require.config({
            baseUrl: URL_STATIC + '/common--javascript',
            paths: {
                'jquery.ui': 'jquery-ui.min',
                'jquery.form': 'jquery.form'
            }
        });
    
    </script>
    
    <meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
            
    
    
    
    
    <meta http-equiv="content-language" content="en"/>
    <script type="text/javascript" src="../images/wikidot.combined.js"></script>
            <script type="text/javascript" src="../images/bootstrap.min.js"></script>
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
             <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
        
        <link href="../images/font-awesome.min.css" rel="stylesheet">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
    
    <style type="text/css" id="internal-style">
        
        /* modules */
        
                /* bootstrap */
            @import url(../images/bootstrap.min.css);
                
        /* theme */
                    @import url(../images/style.css);
                    @import url(../images/style-2.css);
            </style>
    
            <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
          <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        
        
        
    <link rel="shortcut icon" href="../images/favicon.gif"/>
    <link rel="icon" type="image/gif" href="../images/favicon.gif"/>
    
            <link rel="apple-touch-icon" href="../images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png" />
        
        
            <link rel="alternate" type="application/wiki" title="Edit this page" href="javascript:WIKIDOT.page.listeners.editClick()"/>
    
        <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-18234656-1']);
        _gaq.push(['_setDomainName', 'none']);
        _gaq.push(['_setAllowLinker', true]);
        _gaq.push(['_trackPageview']);

        _gaq.push(['old._setAccount', 'UA-68540-5']);
        _gaq.push(['old._setDomainName', 'none']);
        _gaq.push(['old._setAllowLinker', true]);
        _gaq.push(['old._trackPageview']);

                _gaq.push(['userTracker._setAccount', 'UA-26338855-1']);
        _gaq.push(['userTracker._trackPageview']);
            </script>
    
    <script type="text/javascript">
        window.google_analytics_uacct = 'UA-18234656-1';
        window.google_analytics_domain_name = 'none';
    </script>
    
    </head>
<body id="html-body">
<div id="skrollr-body">
<!---------------------------------------------------------
  Standard Template Layout
  Developed by the Wikidot Community
  Version: 1.00.140723
---------------------------------------------------------->

<div class="container-wrap-wrap">
<div class="container-wrap">

<div class="container">
<header class="header-wrap" role="banner">
  
  <nav class="top-bar-wrap navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container top-bar">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-top-target">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html" style="display:none">Home</a>
      </div>
      <div class="collapse navbar-collapse navbar-top-target">

        <ul class="nav navbar-nav">
        

<ul class="nav navbar-nav">
<li><img src="../images/icon-firmware-48.png" alt="icon-firmware-48.png" class="image" /><br /></li>
<li><a href="index.html">Documentation</a><br /></li>
<li><img src="../images/icon-board-48.png" alt="icon-board-48.png" class="image" /><br /></li>
<li><a href="smoothieboard.html">SmoothieBoard</a><br /></li>
<li><img src="../images/icon-blog-48.png" alt="icon-blog-48.png" class="image" /><br /></li>
<li><a href="blog.html">Blog</a><br /></li>
<li><img src="../images/icon-gallery-48.png" alt="icon-gallery-48.png" class="image" /><br /></li>
<li><a href="gallery.html">Gallery</a><br /></li>
<li><img src="../images/icon-community-48.png" alt="icon-community-48.png" class="image" /><br /></li>
<li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Community</a><br />
<ul class="dropdown-menu">
<li><a href="irc.html">IRC : recommended (ﾉ◕ヮ◕)ﾉ*:･ﾟ✧</a></li>
<li><a href="general.html">Forum</a></li>
<li><a href="smoothieware-support.html">Support/Help Mailing list</a></li>
<li><a href="smoothie-dev.html">Developper Mailing list</a></li>
<li><a href="111870450664099533727.html">Google+ Community</a></li>
<li><a href="index-2.html">Facebook page</a></li>
</ul>
</li>
<li><img src="../images/icon-search-48.png" alt="icon-search-48.png" class="image" /><br /></li>
<li><a href="search.html">Search</a><br /></li>
</ul>
<div style="position:fixed; left: 10pt; bottom: -20pt"><img src="../images/smoothie-icon-small-78.png" alt="smoothie-icon-small-78.png" class="image" /></div>


        </ul>
      </div>
    </div>
  </nav>
  
  <div class="header-extra-div-1"><span></span></div>
  <div class="header-extra-div-2"><span></span></div>
  <div class="header-extra-div-3"><span></span></div>
</header>
</div>










 
<main class="content-wrap" role="main">
  <div class="container content">
    <div class="row">
    
      
      <div class="main-content-wrap col-md-12">
        <div class="main-content">
          <div class="page-title page-header" style="display:none"><span>Zprobe</span></div>
          <div class="breadcrumbs"><a href="configuring-smoothie.html">Configuring Smoothie</a> &raquo; <a href="tools.html">Tools</a> &raquo; Zprobe</div>
          <div id="page-content">

<div class="image-container floatright"><img src="../images/8730763008_2663df7782_z.jpg" width="250px" alt="8730763008_2663df7782_z.jpg" class="image" /></div>
<div id="toc" class="floatright">
<div id="toc-action-bar"><a href="javascript:;" onclick="WIKIDOT.page.listeners.foldToc(event)">Fold</a><a style="display: none" href="javascript:;" onclick="WIKIDOT.page.listeners.unfoldToc(event)">Unfold</a></div>
<div class="title">Table of Contents</div>
<div id="toc-list">
<div style="margin-left: 2em;"><a href="#toc0">Hardware requirements:</a></div>
<div style="margin-left: 4em;"><a href="#toc1">The SD CARD must be unmounted from the host before doing any zprobes</a></div>
<div style="margin-left: 2em;"><a href="#toc2">Configuration</a></div>
<div style="margin-left: 4em;"><a href="#toc3">Leveling strategies</a></div>
<div style="margin-left: 3em;"><a href="#toc4">All options</a></div>
<div style="margin-left: 3em;"><a href="#toc5">Leveling strategy options</a></div>
<div style="margin-left: 2em;"><a href="#toc6">Delta calibration</a></div>
<div style="margin-left: 4em;"><a href="#toc7">Radius</a></div>
<div style="margin-left: 3em;"><a href="#toc8">Calibration routine</a></div>
<div style="margin-left: 3em;"><a href="#toc9">Use</a></div>
<div style="margin-left: 4em;"><a href="#toc10">Z height</a></div>
<div style="margin-left: 4em;"><a href="#toc11">Offsets</a></div>
<div style="margin-left: 2em;"><a href="#toc12">Delta Grid Compensation</a></div>
<div style="margin-left: 3em;"><a href="#toc13">Configuration</a></div>
<div style="margin-left: 3em;"><a href="#toc14">Usage</a></div>
<div style="margin-left: 2em;"><a href="#toc15">Three point platform compensation for Cartesians</a></div>
<div style="margin-left: 3em;"><a href="#toc16">Summary</a></div>
<div style="margin-left: 3em;"><a href="#toc17">Configuration</a></div>
<div style="margin-left: 3em;"><a href="#toc18">Usage</a></div>
<div style="margin-left: 2em;"><a href="#toc19">ZGrid level compensation for Morgans (or multipoint bilinear bed leveling)</a></div>
<div style="margin-left: 3em;"><a href="#toc20">Summary</a></div>
<div style="margin-left: 3em;"><a href="#toc21">Configuration</a></div>
<div style="margin-left: 3em;"><a href="#toc22">Usage</a></div>
<div style="margin-left: 2em;"><a href="#toc23">Using FSRs and proximity detectors as a probe</a></div>
</div>
</div>
<h2 id="toc0"><span><strong>Hardware requirements:</strong></span></h2>
<p>You will need a probe switch attached to the machine's actuator, or a bed able to trigger an end stop input when the hotend touches it. (FSRs or another method)</p>
<div class="bs-callout bs-callout-danger">
<h4 id="toc1"><span><strong>The SD CARD must be unmounted from the host before doing any zprobes</strong></span></h4>
<p>Probing is delicate. If the host accesses the SD card while the probing is going on, which it does by itself even if you don't tell it to, unless the card is unmounted, the probe results will be wrong, or worse the probe may even crash into the bed.</p>
<p>Always unmount from the computer before doing Zprobes.</p>
</div>
<h2 id="toc2"><span>Configuration</span></h2>
<p>Add the following to the config file :</p>
<div class="code">
<pre>
<code>gamma_min_endstop            nc                 # normally 1.28. Change to nc to prevent conflict, not needed on Azteeg X5

zprobe.enable                true               # set to true to enable a zprobe
zprobe.probe_pin             1.28!^             # pin probe is attached to if NC remove the !, Azteeg X5 this is 1.29
zprobe.slow_feedrate         5                  # mm/sec probe feed rate
#zprobe.debounce_count       100                # set if noisy
zprobe.fast_feedrate         100                # move feedrate
zprobe.probe_height          5                  # how much above bed to start probe NB only needed for G32 on delta
zprobe.return_feedrate       0                  # feedrate after a probe, default 0 is double of slow_feedrate (mm/s)</code>
</pre></div>
<p><strong>NOTE</strong> the slow_feedrate is the speed the probe moves down to find the bed, it returns (probe up) at 2*slow_feedrate or return_feedrate. fast_feedrate is only used for any XY moves done during probing.</p>
<p><tt>G30</tt> will probe from the current position until it hits the bed and the probe triggers, it will report the distance traveled then return to where it started.</p>
<p><tt>G30 Znnn</tt> will probe until it hits the bed then sets Z to nnn, this can be used to set the nozzle height if nnn is the probes Z offset from the nozzle in the Z direction. <strong>NOTE</strong> this is NOT supported for deltas, use on Cartesians only.</p>
<p><tt>G30 Fxxx</tt> will run the probe at xxx mm/min overriding the slow_feedrate.</p>
<p><tt>G38.2</tt> and <tt>G38.3</tt> are also implemented as documented <a href="gcode.html#sec:G38-probe">here</a></p>
<p>If there are multiple levelling strategies selected the <tt>Pn</tt> parameter will select which one to send leveling codes to, 0 being the first defined one, 1 the second and so on. eg <tt>G29 P1</tt> will send G29 to the second defined levelling strategy.</p>
<p>There are several M670 parameters that can set different settings for zprobe overriding the config settings, these are all saved with M500</p>
<table class="wiki-content-table">
<tr>
<td><tt>M670 S0.50 K2.00 R2.5</tt></td>
<td>Set Probe feedrates slow/fast/return (mm/sec)</td>
</tr>
<tr>
<td><tt>M670 Z200.00</tt></td>
<td>Set Probe max_z (mm)</td>
</tr>
<tr>
<td><tt>M670 H2.00</tt></td>
<td>Set Probe height (mm)</td>
</tr>
<tr>
<td><tt>M670 I1</tt></td>
<td>Temporarily invert the sense of the probe pin (Not saved with M500)</td>
</tr>
</table>
<div class="bs-callout bs-callout-primary">
<h4 id="toc3"><span>Leveling strategies</span></h4>
<p><a name="leveling-strategies"></a></p>
<p>If a <tt>leveling-strategy.xxx.enable</tt> is set to <tt>true</tt> this enables one of the bed leveling strategies described below.</p>
</div>
<h3 id="toc4"><span>All options</span></h3>
<table class="wiki-content-table">
<tr>
<th>Option</th>
<th>Example value</th>
<th>Explanation</th>
</tr>
</table>
<table class="wiki-content-table">
<tr>
<td>zprobe.enable</td>
<td>false</td>
<td>Set to true to enable the Z-probe module. This is used to scan surfaces, and to calibrate parameters and compensate for non-planar surfaces.</td>
</tr>
<tr>
<td>zprobe.probe_pin</td>
<td><tt>1.28!^</tt></td>
<td>Pin the probe is connected to.</td>
</tr>
<tr>
<td>zprobe.slow_feedrate</td>
<td>5</td>
<td>Speed in millimetres/second at which the probe seeks a surface.</td>
</tr>
<tr>
<td>zprobe.fast_feedrate</td>
<td>100</td>
<td>Speed in millimetres/second at which the probe does fast moves.</td>
</tr>
<tr>
<td>zprobe.return_feedrate</td>
<td>50</td>
<td>Speed in millimetres/second at which the probe does the return after a probe.</td>
</tr>
<tr>
<td>zprobe.debounce_count</td>
<td>100</td>
<td>Debounce the probe pin over this number of values. Set to <tt>100</tt> if your probe is too noisy and give false readings.</td>
</tr>
<tr>
<td>zprobe.probe_height</td>
<td>5</td>
<td>Distance above the bed at which the probing is started, once the bed's height is known.</td>
</tr>
</table>
<h3 id="toc5"><span>Leveling strategy options</span></h3>
<table class="wiki-content-table">
<tr>
<th>Option</th>
<th>Example value</th>
<th>Explanation</th>
</tr>
</table>
<table class="wiki-content-table">
<tr>
<td>leveling-strategy.three-point-leveling.enable</td>
<td>true</td>
<td>Set to true to enable the leveling strategy that probes three points to define a plane and then keeps the Z parallel to that plane. This is useful if your Z plate/bed is not perfectly aligned with your XY gantry</td>
</tr>
<tr>
<td>leveling-strategy.three-point-leveling.point1</td>
<td>100.0,0.0</td>
<td>The first probe point (X, Y)</td>
</tr>
<tr>
<td>leveling-strategy.three-point-leveling.point2</td>
<td>200.0,200.0</td>
<td>The second probe point (X, Y)</td>
</tr>
<tr>
<td>leveling-strategy.three-point-leveling.point3</td>
<td>0.0,200.0</td>
<td>The third probe point (X, Y)</td>
</tr>
<tr>
<td>leveling-strategy.three-point-leveling.home_first</td>
<td>true</td>
<td>Home the X and Y axes before probing</td>
</tr>
<tr>
<td>leveling-strategy.three-point-leveling.tolerance</td>
<td>0.03</td>
<td>The probe tolerance in millimetres, anything less that this will be ignored, default is 0.03mm</td>
</tr>
<tr>
<td>leveling-strategy.three-point-leveling.probe_offsets</td>
<td>0,0,0</td>
<td>The probe offset from nozzle, must be X,Y,Z, default is no offset. This is used if your nozzle is not exactly at the same position as where your tool would be.</td>
</tr>
<tr>
<td>leveling-strategy.three-point-leveling.save_plane</td>
<td>false</td>
<td>Set to true to allow the bed plane to be saved with M500, default is false</td>
</tr>
<tr>
<td>leveling-strategy.delta-calibration.enable</td>
<td>true</td>
<td>Set to true to enable the delta calibration levelling strategy. This uses the probe to figure out the plane's tilt and arm's radius in a delta machine</td>
</tr>
<tr>
<td>leveling-strategy.delta-calibration.radius</td>
<td>100</td>
<td>Radius at which to probe the three points</td>
</tr>
<tr>
<td>leveling-strategy.delta-calibration.initial_height</td>
<td>10</td>
<td>the initial height above the bed we stop the initial move down after home to find the bed. This should be a height that is enough that the probe will not hit the bed and is an offset from gamma_max (can be set to 0 if gamma_max takes into account the probe offset)</td>
</tr>
</table>
<h2 id="toc6"><span>Delta calibration</span></h2>
<div class="bs-callout bs-callout-warning">
<h4><span><strong>NOTE</strong></span></h4>
<p>This calibrates the endstops and delta radius only, it is designed to be run once and done, no need to run it before each print. Just run it and save the results. It does <strong>not</strong> set the Z height, that can be done in several different ways as described later.</p>
</div>
<p>Make sure the the config has <tt>delta_homing</tt> true set.</p>
<p>Also in the config set :</p>
<div class="code">
<pre>
<code>leveling-strategy.delta-calibration.enable   true            # basic delta calibration
leveling-strategy.delta-calibration.radius   100             # the probe radius
#the initial height above the bed we stop the intial move down after home to find the bed
#this should be a height that is enough that the probe will not hit the bed and is an offset from gamma_max (can be set to 0 if gamma_max takes into account the probe offset)
leveling-strategy.delta-calibration.initial_height 10 # height above bed to stop initial move</code>
</pre></div>
<div class="bs-callout bs-callout-warning">
<h4 id="toc7"><span>Radius</span></h4>
<p>Note that <tt>leveling-strategy.delta-calibration.radius</tt> should optimally be set such that the probe points are on the circumference of a circle that is equidistant from the center of the bed to the towers.</p>
<p>This minimizes the affect one endstop has on the others when adjusted.</p>
<p>This will usually put the probe points close to the edge of the glass bed.</p>
</div>
<h3 id="toc8"><span>Calibration routine</span></h3>
<p>Issuing the <tt>G32</tt> command will run the full calibration sequence automatically.</p>
<p>It will cycle several times to converge on a good result.</p>
<p>If the result is good use <tt>M500</tt> to save the <tt>M666</tt> settings.</p>
<p>What will happen is it will home the probe down to find the bed, then home again then move down to 5mm above the bed (or whatever you set <tt>zprobe.probe_height</tt> to).</p>
<p>Then it will probe the three towers at the specified <tt>leveling-strategy.delta-calibration.radius</tt> from the center, and will print out the results, it will set the endstop trims and home, this will repeat 3-4 times, each time the difference between the three probes should get smaller, once it has completed 4 probes or the difference is under 0.03mm it will home one last time then probe the three points to confirm the calibration, then probe the center.</p>
<p>It will also adjust the delta radius (<tt>M665 Rnnn</tt>) to get the center the same height as the outside points.</p>
<h3 id="toc9"><span>Use</span></h3>
<p>These are the different ways to use the calibration routine :&nbsp;</p>
<table class="wiki-content-table">
<tr>
<td><tt>G29</tt></td>
<td>will probe the seven points on your bed, you can use this to see how well the bed is leveled.</td>
</tr>
<tr>
<td><tt>G29.1</tt></td>
<td>will probe the seven points on your bed,and output the data that can be fed into some offline least errors scripts to adjust tower offsets</td>
</tr>
<tr>
<td><tt>G32</tt></td>
<td>Does the full calibration sequence, endstop and delta radius</td>
</tr>
<tr>
<td><tt>G32 R0</tt></td>
<td>Will only do delta radius calibration</td>
</tr>
<tr>
<td><tt>G32 E0</tt></td>
<td>Will only do endstop calibration</td>
</tr>
<tr>
<td><tt>G32 I0.02</tt></td>
<td>Will set the target to within 0.02mm</td>
</tr>
<tr>
<td><tt>G32 K0</tt></td>
<td>Will keep the current endstop trim settings and check them, without K the trims are cleared to zero and a full calibration is performed</td>
</tr>
<tr>
<td><tt>G32 J110.0</tt></td>
<td>will set the probe radius to 110.0&#160;mm for this session</td>
</tr>
</table>
<div class="bs-callout bs-callout-warning">
<h4 id="toc10"><span>Z height</span></h4>
<p>You will need to set the z height after calibration using one of the several methods available mentioned here [<a href="delta.html">http://smoothieware.org/delta</a>]</p>
</div>
<div class="bs-callout bs-callout-warning">
<h4 id="toc11"><span>Offsets</span></h4>
<p>There are <strong>NO</strong> probe offsets for delta calibration, so the probe should be within 10-20mm of the nozzle. This is by design as the calibration works solely on relative positions.</p>
<p>To be clear :&nbsp;there are no offsets in Smoothie, and they would not be useful as calibration is relative. This can be confusing to Marlin users. Just use it and you'll see.</p>
</div>
<div class="bs-callout bs-callout-info">
<p>If you are getting the <tt>Calibration failed to complete</tt> error it usually means you need to increase the<br />
<tt>leveling-strategy.delta-calibration.initial_height</tt> config setting to a bigger value, try 10 or 20 or bigger.</p>
</div>
<p>See <a href="index-74.html">http://minow.blogspot.com/</a> for more details of calibrating a delta.</p>
<hr />
<h2 id="toc12"><span>Delta Grid Compensation</span></h2>
<p>Probes delta_grid.size points in X and Y (total probes size * size) and stores the relative offsets from the 0,0 Z height.<br />
When enabled every move will calculate the Z offset based on interpolating the height offset within the grids nearest 4 points.<br />
Should be used in conjunction with the delta calibration strategy above. First calibrate with G32 then if needed do G31 to set the grid compensation.<br />
<strong>NOTE</strong> The delta-grid.radius specified should be at least as big as the largest X,Y position likely to be moved to. It gets very inaccurate if you try to print outside of the radius you specified.</p>
<h3 id="toc13"><span>Configuration</span></h3>
<p>The strategy must be enabled in the config as well as zprobe.</p>
<div class="code">
<pre>
<code>leveling-strategy.delta-grid.enable         true</code>
</pre></div>
<p>The radius of the bed must be specified with&#8230;</p>
<div class="code">
<pre>
<code>leveling-strategy.delta-grid.radius        50</code>
</pre></div>
<p>this needs to be at least as big as the maximum printing radius as moves outside of this will not be compensated for correctly</p>
<p>The size of the grid can be set with&#8230;</p>
<div class="code">
<pre>
<code>leveling-strategy.delta-grid.size        7</code>
</pre></div>
<p>this is the X and Y size of the grid, it must be an odd number, the default is 7 which is 49 probe points</p>
<p>Optionally probe offsets from the nozzle or tool head can be defined with&#8230;</p>
<div class="code">
<pre>
<code>leveling-strategy.delta-grid.probe_offsets  0,0,0  # probe offsetrs x,y,z</code>
</pre></div>
<p>they may also be set with M565 X0 Y0 Z0. <strong>NOTE</strong> setting probe offsets will make the grid less effective the further the probe is from the head, this is especially true if you are using it to correct geometry errors, as they depend on the actuator position not the head position. So having a probe offset from the head will try to compensate for errors which are offset from where the head actually is. There is no easy way to overcome this other than have the probe as close to the nozzle as possible.</p>
<p>If the saved grid is to be loaded on boot then this must be set in the config&#8230;</p>
<div class="code">
<pre>
<code>leveling-strategy.delta-grid.save        true</code>
</pre></div>
<p>Then when M500 is issued it will save M375 which will cause the grid to be loaded on boot. The default is to not autoload the grid on boot. <strong>NOTE</strong> the grid size and the radius is saved in the file, and restored when it is loaded with M375. If the grid size is different from the one in config it will <strong>NOT</strong> load. If the radius is different, then the radius will be set to whatever was saved overriding the one set in config.</p>
<p>Optionally an initial_height can be set that tell the initial probe where to stop the fast decent before it probes, this should be around 5-10mm above the bed</p>
<div class="code">
<pre>
<code>leveling-strategy.delta-grid.initial_height  10</code>
</pre></div>
<h3 id="toc14"><span>Usage</span></h3>
<table class="wiki-content-table">
<tr>
<td><tt>G29</tt></td>
<td>test probes in a grid pattern within the radius producing a map of offsets, this can be imported into a graphing program to visualize the bed (NOTE if delta calibration is also enabled then this is executed with <tt>G29 P1</tt>). optional parameters <tt>In</tt> sets the number of points to the value n, <tt>Jn</tt> sets the radius for this probe.</td>
</tr>
<tr>
<td><tt>G29.1</tt></td>
<td>test probes in a spiral pattern within the radius producing a map of offsets, this can be imported into a graphing program to visualize the bed heights (NOTE if delta calibration is also enabled then this is executed with <tt>G29 P1</tt>). optional parameters <tt>In</tt> sets the number of points to the value n, <tt>Jn</tt> sets the radius for this probe.</td>
</tr>
<tr>
<td><tt>G31</tt></td>
<td>probes the grid and turns the compensation on, this will remain in effect until reset or <tt>M561/M370</tt> optional parameters <tt>Jn</tt> sets the radius for this probe.</td>
</tr>
<tr>
<td><tt>M370</tt></td>
<td>clears the grid and turns off compensation</td>
</tr>
<tr>
<td><tt>M374</tt></td>
<td>Save grid to /sd/delta.grid</td>
</tr>
<tr>
<td><tt>M374.1</tt></td>
<td>delete /sd/delta.grid</td>
</tr>
<tr>
<td><tt>M375</tt></td>
<td>Load the grid from /sd/delta.grid and enable compensation</td>
</tr>
<tr>
<td><tt>M375.1</tt></td>
<td>display the current grid</td>
</tr>
<tr>
<td><tt>M561</tt></td>
<td>clears the grid and turns off compensation</td>
</tr>
<tr>
<td><tt>M565</tt></td>
<td>defines the probe offsets from the nozzle or tool head</td>
</tr>
<tr>
<td><tt>M500</tt></td>
<td>saves the probe points</td>
</tr>
<tr>
<td><tt>M503</tt></td>
<td>displays the current settings</td>
</tr>
</table>
<hr />
<h2 id="toc15"><span>Three point platform compensation for Cartesians</span></h2>
<p>Also incorrectly called bed leveling.</p>
<div class="bs-callout bs-callout-danger">
<h4><span><strong>DO NOT USE ON DELTAS</strong></span></h4>
<p>It just won't work. Use the delta-specific strategy above.</p>
</div>
<div class="bs-callout bs-callout-success">
<h4><span>the following third party user guide is helpful :&nbsp;</span></h4>
<ul>
<li><a href="index-75.html">Z-Probe with Smoothie</a></li>
</ul>
<p>However note it is <strong>NOT</strong> recommended to automate the probe sequence in your gcode as suggested in that post.</p>
</div>
<div class="image-container floatright"><img src="../images/3-point.svg" width="250px" alt="3-point.svg" class="image" /></div>
<h3 id="toc16"><span>Summary</span></h3>
<p>Probes three user specified points on the bed and determines the plane of the bed relative to the probe.</p>
<p>As the head moves in X and Y it will adjust Z to keep the head tram with the bed.</p>
<p><strong>NOTE</strong> The probe does not set the bed height, the probes find the relative level of the bed based on the first probe point, so after you have defined the bed plane with G32, you then set the bed height at the first probe point and use M206 or M306 to set the homing offset. Once saved you do not need to do zprobe or bed height again. In this case it is best to have a Z endstop as well as the ZProbe. the Z endstop is used to set the bed height after the probe.<br />
This is different to other Firmware and is deliberate. This allows people to use temporary Z probes and not have a permanent z probe or know the exact Z offset of the probe in relation to the nozzle.</p>
<h3 id="toc17"><span>Configuration</span></h3>
<p>The strategy must be enabled in the config as well as zprobe.</p>
<div class="code">
<pre>
<code>leveling-strategy.three-point-leveling.enable         true</code>
</pre></div>
<p>Three probe points must be defined, these are best if they are the three points of an equilateral triangle, as far apart as possible.<br />
They can be defined in the config file as:-</p>
<div class="code">
<pre>
<code>leveling-strategy.three-point-leveling.point1         100.0,0.0   # the first probe point (x,y)
leveling-strategy.three-point-leveling.point2         200.0,200.0 # the second probe point (x,y)
leveling-strategy.three-point-leveling.point3         0.0,200.0   # the third probe point (x,y)</code>
</pre></div>
<p>Or they may be defined (and saved with <tt>M500</tt>) using <tt>M557 P0 X30 Y40.5</tt> where <tt>P</tt> is <tt>0,1,2</tt></p>
<p>Probe offsets from the nozzle or tool head can be defined with :</p>
<div class="code">
<pre>
<code>leveling-strategy.three-point-leveling.probe_offsets  0,0,0  # probe offsets x,y,z</code>
</pre></div>
<p>They may also be set with <tt>M565 X0 Y0 Z0</tt></p>
<p>To force homing in X and Y before <tt>G32</tt> does the probe the following can be set in config, this is the default</p>
<div class="code">
<pre>
<code>leveling-strategy.three-point-leveling.home_first    true   # disable by setting to false</code>
</pre></div>
<p>The probe tolerance can be set using the config</p>
<div class="code">
<pre>
<code>leveling-strategy.three-point-leveling.tolerance   0.03    # the probe tolerance in mm, default is 0.03mm</code>
</pre></div>
<p>You can save the bed plane so it can be used again without probing again presuming the bed stays flat etc. to do this you must enable the feature</p>
<div class="code">
<pre>
<code>leveling-strategy.three-point-leveling.save_plane   true    #</code>
</pre></div>
<p>For this to be effective you must do your Z home to the first probe point defined when creating the plane. Set the Z height to zero at the first probe point,<br />
then the bed plane should be relative from that point on. You save it with <tt>M500</tt>, although it will not display with <tt>M503</tt> as it is not a user settable function.</p>
<p>A nice guide is here. <a href="index-75.html">http://reprapme.com/2015/07/z-probing/</a> although use of an automatic probe deploy is entirely optional, and running a probe every print is also not the recommended way to use this, it is preferable to probe once and save the results, no more probes are required unless something changes on your bed.</p>
<h3 id="toc18"><span>Usage</span></h3>
<p>The machine must be homed in X and Y before running the probe.<br />
If you need to set the bed height after probing you must set the height at the first probe point, and save it with homing offsets. (M206 or M306)</p>
<table class="wiki-content-table">
<tr>
<td><tt>G29</tt></td>
<td>probes the three probe points and reports the Z at each point, if a plane is active it will be used to level the probe.</td>
</tr>
<tr>
<td><tt>G32</tt></td>
<td>Probes the three probe points and defines the bed plane, this will remain in effect until reset or <tt>M561</tt></td>
</tr>
<tr>
<td><tt>G31</tt></td>
<td>Reports the status</td>
</tr>
<tr>
<td><tt>M557</tt></td>
<td>Defines the probe points</td>
</tr>
<tr>
<td><tt>M561</tt></td>
<td>Clears the plane and the bed leveling is disabled until <tt>G32</tt> is run again</td>
</tr>
<tr>
<td><tt>M565</tt></td>
<td>Defines the probe offsets from the nozzle or tool head</td>
</tr>
<tr>
<td><tt>M500</tt></td>
<td>Saves the probe points and the probe offsets</td>
</tr>
<tr>
<td><tt>M503</tt></td>
<td>Displays the current settings</td>
</tr>
</table>
<p>Example use :</p>
<div class="code">
<pre>
<code>    G28 (Home XYZ)
    Move Z up to about 30mm and attach probe
    G32
    remove probe.
    M500 (to save probe results)
    Move to the Probe P0 point (first probe point)
    jog down to touch the plate
    M306 Z0
    M500 (to save homing offset)
    G28
    Move to 0,0 check Z height
    Move to P0 check z height ditto for P1 and P2</code>
</pre></div>
<h2 id="toc19"><span>ZGrid level compensation for Morgans (or multipoint bilinear bed leveling)</span></h2>
<p><strong>NOTE</strong> It is fully functional and tested on Morgan machines only.</p>
<p><strong>NOTE</strong> this currently does not work on Deltas (use DeltaGrid) and is not well tested on Cartesians. If you want to use it on those platforms please report any problems in the Github issue tracker with a subject [ZGrid] problem summary (Where problem summary is replaced with a summary of your problem).</p>
<h3 id="toc20"><span>Summary</span></h3>
<p>Probes a grid of user specified number of points on the bed and populates a data array of offsets to be used with a bilinear offset calculation.</p>
<p>As the head moves in X and Y it will adjust Z to keep the head tracking the bed surface.</p>
<h3 id="toc21"><span>Configuration</span></h3>
<p>The strategy must be enabled in the config as well as zprobe.</p>
<div class="code">
<pre>
<code>leveling-strategy.ZGrid-leveling.enable         true</code>
</pre></div>
<p>The bed size limits must be defined, in order for the module to calculate the calibration points</p>
<div class="code">
<pre>
<code>leveling-strategy.ZGrid-leveling.bed_x           200
leveling-strategy.ZGrid-leveling.bed_y           200</code>
</pre></div>
<p>Also ensure that the max Z is defined and valid for the machine (Gamma end stop section)</p>
<div class="code">
<pre>
<code>gamma_max                                    200              #</code>
</pre></div>
<p>The number of divisions for X and Y should be defined</p>
<div class="code">
<pre>
<code>leveling-strategy.ZGrid-leveling.rows           7          # X divisions (Default 5)
leveling-strategy.ZGrid-leveling.cols           9          # Y divisions (Default 5)</code>
</pre></div>
<p>The probe offset should be defined, default to zero offset</p>
<div class="code">
<pre>
<code>leveling-strategy.ZGrid-leveling.probe_offsets  0,0,16.3</code>
</pre></div>
<p>slow feedrate can be defined for probe speed</p>
<div class="code">
<pre>
<code>leveling-strategy.ZGrid-leveling.slow_feedrate  100</code>
</pre></div>
<h3 id="toc22"><span>Usage</span></h3>
<p>The machine will home automatically when running the probe.<br />
The machine will then position the head in the center of the defined space for probe attachment (if required)<br />
When ready, trigger the probe manually to start the probe run.</p>
<table class="wiki-content-table">
<tr>
<td><tt>G32</tt></td>
<td>Probes the probe points and defines the bed ZGrid, this will remain in effect until reset or <tt>M370</tt></td>
</tr>
<tr>
<td><tt>G31</tt></td>
<td>Reports the status and displays grid data</td>
</tr>
</table>
<table class="wiki-content-table">
<tr>
<td><tt>M370</tt></td>
<td>clears the ZGrid and the bed leveling is disabled until G32 is run again</td>
</tr>
<tr>
<td><tt>M370 X7 Y9</tt></td>
<td>Overrides config grid size and allocates a new grid size of 7x9 and clears as above</td>
</tr>
<tr>
<td><tt>M371</tt></td>
<td>Moves the head to the next calibration position without saving for manual calibration</td>
</tr>
<tr>
<td><tt>M372</tt></td>
<td>Moves the head to the next calibration position after saving the current probe point to memory - manual calibration</td>
</tr>
<tr>
<td><tt>M373</tt></td>
<td>Completes manual calibration and enables the Z compensation grid</td>
</tr>
</table>
<table class="wiki-content-table">
<tr>
<td><tt>M374</tt></td>
<td>Saves the grid to a file on the SD card (ZGrid). This file contains the grid size, and Z-offset so that the system can recall the exact position. Ensure that the M306 Z calibration is performed before saving the grid.</td>
</tr>
<tr>
<td><tt>M375</tt></td>
<td>Recall the saved grid file from the SD card</td>
</tr>
</table>
<table class="wiki-content-table">
<tr>
<td><tt>M565</tt></td>
<td>Defines the probe offsets from the nozzle or tool head</td>
</tr>
<tr>
<td><tt>M500</tt></td>
<td>Saves the probe offsets</td>
</tr>
<tr>
<td><tt>M503</tt></td>
<td>Displays the current settings</td>
</tr>
</table>
<h4><span>ZGrid file</span></h4>
<p>The Zgrid file is a simple list of offsets prefaced by the Z probe length and the XY probe count. The order is identical to the probing order.</p>
<h5><span>Example:</span></h5>
<p>In the file below, P100 refers to the number of probe points to sample.<br />
The two 10s are the number of rows and columns (X, Y), and the floating point number is the Z home offset.<br />
The rest of the values are the probing offsets (calculated as the travel distance - the home offset). Higher values indicate that the probe moved less before triggering (so the bed at that point is higher), smaller values mean bed is lower.<br />
P100&#160;10&#160;10&#160;20.100<br />
1.725<br />
0.663<br />
0.413<br />
0.725<br />
0.625<br />
0.513<br />
0.375<br />
0.263<br />
&#8230;<br />
1.025<br />
0.875<br />
0.956</p>
<h2 id="toc23"><span>Using FSRs and proximity detectors as a probe</span></h2>
<div class="bs-callout bs-callout-info">
<h4><span>A message about FSRs and other non contact probes</span></h4>
<p>If you use these and do not get a good calibration result, look closely at the probe repeatability on different parts of the bed, before you blame Smoothie.</p>
<p>FSRs need to be mounted in a very particular way so they do not trigger by vibration, and do not need too much force before triggering. Proximity probes tend to give different results depending on where they are on the bed, different densities of the underlying metal and less metal at the edges affects this, making the calibration results less than optimal.</p>
</div>
<p>Setting up FSRs to work reliably is tricky&#8230;</p>
<p>To use FSR's with the smoothieboard an aux board is needed to interface the FSR's to the smoothieboard's endstop input. Smoothieware will accept this input as if it was a simple mechanical switch.</p>
<p>JohnSL <a href="fsr_endstop.html">(Github)</a> has created such a board. It is available via <a href="index-76.html#3D-Printer-FSR" target="_blank">TriD Printing</a> &amp; <a href="fsr-leveling.html" target="_blank">UltiBots</a>. See <a href="auto-adjust-fsr-end-stop-detector.html">John's blog post</a> about the board. This board is powered from the endstop pins.</p>
<p>The <a href="index-77.html#!searchin/deltabot/fsr" target="_blank">Deltabot</a> group is where most discussion on using FSR's is located.<br />
Topics to look for are:</p>
<ul>
<li>Alternative boards like the arduino mini.</li>
<li>WingWong's trinket derived design.</li>
<li>Mounting of FSR's</li>
</ul>
</div>
          
          <div style="height:150px"></div>
          <div class="page-info-break"></div>
          <div class="page-options-container"><div id="page-info">page revision: 107, last edited: <span class="odate time_1462039718 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%20%28%25O%20ago%29">30 Apr 2016 18:08</span></div>
            <div id="page-options-bottom"  class="page-options-bottom">
            <a href="javascript:;" class="btn btn-default" id="edit-button">Edit</a>
<a href="javascript:;" class="btn btn-default" id="tags-button">Tags</a>

<a href="javascript:;" class="btn btn-default" id="history-button">History</a>
<a href="javascript:;" class="btn btn-default" id="files-button">Files</a>
<a href="javascript:;" class="btn btn-default" id="print-button">Print</a>
<a href="javascript:;" class="btn btn-default" id="site-tools-button">Site tools</a>
<a href="javascript:;" class="btn btn-default" id="more-options-button">+&nbsp;Options</a> 
</div>
<div id="page-options-bottom-2" class="page-options-bottom form-actions" style="display:none">
    <a href="javascript:;" class="btn btn-default" id="edit-sections-button">Edit Sections</a>
    <a href="javascript:;" class="btn btn-default" id="edit-append-button">Append</a>
    <a href="javascript:;" class="btn btn-default" id="edit-meta-button">Edit Meta</a>
    <a href="javascript:;" class="btn btn-default" id="watchers-button">Watchers</a> 
    <a href="javascript:;" class="btn btn-default" id="backlinks-button">Backlinks</a> 
    <a href="javascript:;" class="btn btn-default" id="view-source-button">Page Source</a> 
    <a href="javascript:;" class="btn btn-default" id="parent-page-button">Parent</a> 
    <a href="javascript:;" class="btn btn-default" id="page-block-button">Lock Page</a>    
    <a href="javascript:;" class="btn btn-default" id="rename-move-button">Rename</a> 
    <a href="javascript:;" class="btn btn-default" id="delete-button">Delete</a> 
</div>
<div id="page-options-area-bottom">
</div>
</div>
          <div id="action-area" style="display: none;"></div>
        </div>
      </div>
    </div>
  </div>
</main>
 
<footer class="footer-wrap" role="contentinfo">
  <div class="container footer">
    <div class="options" style="display: block; visibility: visible;">
    <a href="doc_start.html" id="wikidot-help-button">Help</a>
    &nbsp;|
    <a href="legal_terms-of-service.html" id="wikidot-tos-button">Terms of Service</a>
    &nbsp;|
    <a href="legal_privacy-policy.html" id="wikidot-privacy-button">Privacy</a>
    &nbsp;|
    <a href="javascript:;" id="bug-report-button" onclick="WIKIDOT.page.listeners.pageBugReport(event)">Report a bug</a>
    &nbsp;|
    <a href="javascript:;" id="abuse-report-button" onclick="WIKIDOT.page.listeners.flagPageObjectionable(event)">Flag as objectionable</a>
</div>
Powered by <a href="index-4.html">Wikidot.com</a> 
    <div class="license-area">Unless otherwise stated, the content of this page is licensed under <a rel="license" href="index-5.html">Creative Commons Attribution-ShareAlike 3.0 License</a></div>
  </div>
  <div class="extrac-div-1"><span></span></div>
  <div class="extrac-div-2"><span></span></div>
  <div class="extrac-div-3"><span></span></div>
</footer>
 

</div> <!-- container-wrap -->
 
<div class="extra-div-1"><span></span></div>
<div class="extra-div-2"><span></span></div>
<div class="extra-div-3"><span></span></div>
<div class="extra-div-4"><span></span></div>
<div class="extra-div-5"><span></span></div>
<div class="extra-div-6"><span></span></div>
</div> <!-- container-wrap-wrap -->
</div>
<div id="dummy-ondomready-block" style="display: none;" ></div>
    <!-- Google Analytics load -->
    <script type="text/javascript">
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

    <!-- Quantcast -->
    <script type="text/javascript">
    _qoptions={
        qacct:"p-edL3gsnUjJzw-"
    };
    (function() {
        var qc = document.createElement('script'); qc.type = 'text/javascript'; qc.async = true;
        qc.src = ('https:' == document.location.protocol ? 'https://secure' : 'http://edge') + '.quantserve.com/quant.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(qc, s);
    })();
    </script>
    <noscript>
        <img src="../images/p-edl3gsnujjzw-.gif" style="display: none;" border="0" height="1" width="1" alt="Quantcast"/>
    </noscript>




<div id="page-options-bottom-tips" style="display: none;">
    <div id="edit-button-hovertip">
        Click here to edit contents of this page.    </div>
</div>
<div id="page-options-bottom-2-tips"  style="display: none;">
    <div id="edit-sections-button-hovertip">
        Click here to toggle editing of individual sections of the page (if possible).         Watch headings for an &quot;edit&quot; link when available.    </div>
    <div id="edit-append-button-hovertip">
        Append content without editing the whole page source.    </div>
    <div id="history-button-hovertip">
        Check out how this page has evolved in the past.    </div>
    <div id="discuss-button-hovertip">
        If you want to discuss contents of this page - this is the easiest way to do it.    </div>
    <div id="files-button-hovertip">
        View and manage file attachments for this page.    </div>
    <div id="site-tools-button-hovertip">
        A few useful tools to manage this Site.    </div>
    <div id="backlinks-button-hovertip">
        See pages that link to and include this page.    </div>
    <div id="rename-move-button-hovertip">
        Change the name (also URL address, possibly the category) of the page.    </div>
    <div id="view-source-button-hovertip">
        View wiki source for this page without editing.    </div>
    <div id="parent-page-button-hovertip">  
        View/set parent page (used for creating breadcrumbs and structured layout).    </div>
            <div id="abuse-report-button-hovertip">
            Notify administrators if there is objectionable content in this page.        </div>
        <div id="bug-report-button-hovertip">
            Something does not work as expected? Find out what you can do.        </div>
        <div id="wikidot-help-button-hovertip">
            General Wikidot.com documentation and help section.        </div>
        <div id="wikidot-tos-button-hovertip">
            Wikidot.com Terms of Service - what you can, what you should not etc.        </div>
        <div id="wikidot-privacy-button-hovertip">
            Wikidot.com Privacy Policy.          
        </div>
    </div>
</body>

<!-- Mirrored from smoothieware.org/zprobe by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 May 2016 11:45:29 GMT -->
</html>