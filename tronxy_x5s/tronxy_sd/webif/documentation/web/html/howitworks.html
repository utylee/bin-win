<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">


<!-- Mirrored from smoothieware.org/howitworks by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 May 2016 11:57:39 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <title>Howitworks - Smoothie Project</title>
    
    	<script type="text/javascript" src="login__customdomainscriptf36a.html?site_id=269117"></script>

    
    <script type="text/javascript" src="../images/init.combined.js"></script>
    <script  type="text/javascript">
        var URL_HOST = 'www.wikidot.com';
        var URL_DOMAIN = 'wikidot.com';
        var USE_SSL =  true ;
        var URL_STATIC = '../images/v--edac79f846ba';
        // global request information
        
        var WIKIREQUEST = {};
        WIKIREQUEST.info = {};
        
        WIKIREQUEST.info.domain = "smoothieware.org";
        WIKIREQUEST.info.siteId = 269117;
        WIKIREQUEST.info.siteUnixName = "chibidibidiwah";
        WIKIREQUEST.info.categoryId = 1474485;
        WIKIREQUEST.info.themeId = 256585;
        WIKIREQUEST.info.requestPageName = "howitworks";
        OZONE.request.timestamp = 1463138551;
        OZONE.request.date = new Date();
        WIKIREQUEST.info.lang = 'en';
                WIKIREQUEST.info.pageUnixName = "howitworks";
        WIKIREQUEST.info.pageId = 11888545;
                        WIKIREQUEST.info.lang = "en";
        OZONE.lang = "en";
        var isUAMobile = !!/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    </script>
    
    


    
        <script  type="text/javascript">
    
        require.config({
            baseUrl: URL_STATIC + '/common--javascript',
            paths: {
                'jquery.ui': 'jquery-ui.min',
                'jquery.form': 'jquery.form'
            }
        });
    
    </script>
    
    <meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
            
    
    
    
    
    <meta http-equiv="content-language" content="en"/>
    <script type="text/javascript" src="../images/wikidot.combined.js"></script>
            <script type="text/javascript" src="../images/bootstrap.min.js"></script>
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
             <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
        
        <link href="../images/font-awesome.min.css" rel="stylesheet">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
    
    <style type="text/css" id="internal-style">
        
        /* modules */
        
                /* bootstrap */
            @import url(../images/bootstrap.min.css);
                
        /* theme */
                    @import url(../images/style.css);
                    @import url(../images/style-2.css);
            </style>
    
            <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
          <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        
        
        
    <link rel="shortcut icon" href="../images/favicon.gif"/>
    <link rel="icon" type="image/gif" href="../images/favicon.gif"/>
    
            <link rel="apple-touch-icon" href="../images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="../images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png" />
        
        
            <link rel="alternate" type="application/wiki" title="Edit this page" href="javascript:WIKIDOT.page.listeners.editClick()"/>
    
        <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-18234656-1']);
        _gaq.push(['_setDomainName', 'none']);
        _gaq.push(['_setAllowLinker', true]);
        _gaq.push(['_trackPageview']);

        _gaq.push(['old._setAccount', 'UA-68540-5']);
        _gaq.push(['old._setDomainName', 'none']);
        _gaq.push(['old._setAllowLinker', true]);
        _gaq.push(['old._trackPageview']);

                _gaq.push(['userTracker._setAccount', 'UA-26338855-1']);
        _gaq.push(['userTracker._trackPageview']);
            </script>
    
    <script type="text/javascript">
        window.google_analytics_uacct = 'UA-18234656-1';
        window.google_analytics_domain_name = 'none';
    </script>
    
    </head>
<body id="html-body">
<div id="skrollr-body">
<!---------------------------------------------------------
  Standard Template Layout
  Developed by the Wikidot Community
  Version: 1.00.140723
---------------------------------------------------------->

<div class="container-wrap-wrap">
<div class="container-wrap">

<div class="container">
<header class="header-wrap" role="banner">
  
  <nav class="top-bar-wrap navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container top-bar">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-top-target">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html" style="display:none">Home</a>
      </div>
      <div class="collapse navbar-collapse navbar-top-target">

        <ul class="nav navbar-nav">
        

<ul class="nav navbar-nav">
<li><img src="../images/icon-firmware-48.png" alt="icon-firmware-48.png" class="image" /><br /></li>
<li><a href="index.html">Documentation</a><br /></li>
<li><img src="../images/icon-board-48.png" alt="icon-board-48.png" class="image" /><br /></li>
<li><a href="smoothieboard.html">SmoothieBoard</a><br /></li>
<li><img src="../images/icon-blog-48.png" alt="icon-blog-48.png" class="image" /><br /></li>
<li><a href="blog.html">Blog</a><br /></li>
<li><img src="../images/icon-gallery-48.png" alt="icon-gallery-48.png" class="image" /><br /></li>
<li><a href="gallery.html">Gallery</a><br /></li>
<li><img src="../images/icon-community-48.png" alt="icon-community-48.png" class="image" /><br /></li>
<li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Community</a><br />
<ul class="dropdown-menu">
<li><a href="irc.html">IRC : recommended (ﾉ◕ヮ◕)ﾉ*:･ﾟ✧</a></li>
<li><a href="general.html">Forum</a></li>
<li><a href="http://groups.google.com/group/smoothieware-support">Support/Help Mailing list</a></li>
<li><a href="http://groups.google.com/group/smoothie-dev">Developper Mailing list</a></li>
<li><a href="111870450664099533727.html">Google+ Community</a></li>
<li><a href="index-2.html">Facebook page</a></li>
</ul>
</li>
<li><img src="../images/icon-search-48.png" alt="icon-search-48.png" class="image" /><br /></li>
<li><a href="search.html">Search</a><br /></li>
</ul>
<div style="position:fixed; left: 10pt; bottom: -20pt"><img src="../images/smoothie-icon-small-78.png" alt="smoothie-icon-small-78.png" class="image" /></div>


        </ul>
      </div>
    </div>
  </nav>
  
  <div class="header-extra-div-1"><span></span></div>
  <div class="header-extra-div-2"><span></span></div>
  <div class="header-extra-div-3"><span></span></div>
</header>
</div>










 
<main class="content-wrap" role="main">
  <div class="container content">
    <div class="row">
    
      
      <div class="main-content-wrap col-md-12">
        <div class="main-content">
          <div class="page-title page-header" style="display:none"><span>Howitworks</span></div>
          
          <div id="page-content">

<h1 id="toc0"><span>Basics</span></h1>
<div class="image-container aligncenter"><a href="https://www.flickr.com/photos/arthurwolf/6249349954/"><img src="https://farm7.static.flickr.com/6040/6249349954_bff0ecc9f2_z.jpg" alt="flickr:6249349954" class="image" /></a></div>
<p>In it's most basic form, the job of Smoothie is to receive <a href="g-code.html">G-code</a> commands, and translate those into actual movement for a robot.</p>
<p>This is done in several steps :&nbsp;</p>
<ul>
<li>The <a href="https://github.com/arthurwolf/Smoothie/blob/master/src/modules/communication/SerialConsole.cpp">SerialConsole</a> module, reads the serial port ( UART or USB ), and when a line is recognized, it follows it to all modules that asked for it by triggering the <em>on_console_line_received</em> event.</li>
<li>The <a href="https://github.com/arthurwolf/Smoothie/blob/master/src/modules/communication/GcodeDispatch.cpp">GcodeDispatch</a> module is one of those : it registered for the <em>on_console_line_received</em> event, and is thus called everytime the SerialConsole module triggers it. It takes the new line, and if it recognizes a G-code command, transforms it into a new <a href="https://github.com/arthurwolf/Smoothie/blob/master/src/modules/communication/utils/Gcode.cpp">Gcode</a> object, and triggers the <em>on_gcode_received</em> event.</li>
<li>The <a href="https://github.com/arthurwolf/Smoothie/blob/master/src/modules/robot/Robot.cpp">Robot</a> module listens to this event, and so is then triggered. It uses math to cut the requested move into line segments, and passes those to the <a href="https://github.com/arthurwolf/Smoothie/blob/master/src/modules/robot/Planner.cpp">Planner</a> module. There they are transformed into <a href="https://github.com/arthurwolf/Smoothie/blob/master/src/modules/robot/Block.cpp">Block</a> objects, containing speed, direction and acceleration information. The acceleration profile for the Planner's queue ( list of upcoming Blocks ) is re-computed to take the new Block into account, and finally that Block is added to the queue.</li>
<li>The <a href="https://github.com/arthurwolf/Smoothie/blob/master/src/modules/robot/Stepper.cpp">Stepper</a> module itself enters the game whenever there is a Block in the Planner's queue :&nbsp;is composed of two loops :&nbsp;
<ul>
<li>The stepping loop, which pops new blocks if necessary, and actually sends the step and direction command to the stepper motor drivers to move the motors</li>
<li>The acceleration loop, which updates the stepping loop's speed depending on the acceleration profile for this block</li>
</ul>
</li>
</ul>
<p>Now let's get into more detail for each part :&nbsp;</p>
<h1 id="toc1"><span>GcodeDispatch</span></h1>
<div class="image-container aligncenter"><a href="https://www.flickr.com/photos/arthurwolf/6248821477/"><img src="https://farm7.static.flickr.com/6119/6248821477_15aac886cd_z.jpg" alt="flickr:6248821477" class="image" /></a></div>
<p>It is interesting to note that here we are interested only in G-code commands, but the <em>on_console_line_received</em> event actually gets called with any new line, to any module that registered for it ( see <a href="https://github.com/arthurwolf/Smoothie/blob/master/src/libs/Kernel.cpp">Kernel</a>, <a href="https://github.com/arthurwolf/Smoothie/blob/master/src/libs/Module.cpp">Module</a> and the <a href="moduleexample.html">Module example</a> ). This can for example be used to handle <a href="console-commands.html">command-line like</a> instructions.</p>
<p>The <a href="https://github.com/arthurwolf/Smoothie/blob/master/src/modules/communication/utils/Gcode.cpp">Gcode</a> object is just a wrapper around the actual string, it just provides helper function to retrieve values from that string.</p>
<h1 id="toc2"><span>Robot</span></h1>
<div class="image-container aligncenter"><a href="https://www.flickr.com/photos/arthurwolf/6249350092/"><img src="https://farm7.static.flickr.com/6167/6249350092_9ddb8439d8_z.jpg" alt="flickr:6249350092" class="image" /></a></div>
<p>Again here we are interested only in movement G-codes, but any module that registers for the <em>on_gcode_received</em> event will be called with that G-code and gets a chance to use it. Even this module ( Robot ) actually recognizes not only movement G-codes, but also mode changing G-codes ( absolute/relative, inch/millimeter etc &#8230; ).</p>
<p>However, if you are coding a new module, you are probably more interested in the <em>on_gcode_execute</em> event which is triggered when the move actually happens ( when the corresponding Block in the queue is about to be executed ), than in this event, which is only for when the command is received.</p>
<p>The segment cutting part is a port of grbl, more specifically, <a href="https://github.com/chamnit/grbl">chamnit's ameliorations to edge</a>.</p>
<h1 id="toc3"><span>Planner</span></h1>
<div class="image-container aligncenter"><a href="https://www.flickr.com/photos/arthurwolf/6249350188/"><img src="https://farm7.static.flickr.com/6119/6249350188_90566e9a2e_z.jpg" alt="flickr:6249350188" class="image" /></a></div>
<p>To the contrary of previous module-to-module transfer, we did not here use an event call/even handler. This is because the new line segment the Planner receives really only matters for the Planner, so an event call here would be superfluous. However if you have an use case where plugging in here would have some sense, <a href="mailto:wolf.arthur@gmail.com">just ask</a>.</p>
<p>Again here, the math-heavy acceleration curves planning part is a port of grbl, more specifically, <a href="https://github.com/chamnit/grbl">chamnit's ameliorations to edge</a>.</p>
<p>At the end here, we add the new Block to the queue. Now the goal of this is for the Stepper to use this Block and move the stepper motors according to it. But we don't need to call the Stepper to tell it to step this Block : it is probably busy stepping a Block we previously added to the queue. We just push the Block to the top of the queue, and it will be executed by the Stepper when it reaches the bottom of the queue because all of the previous Blocks have been executed.</p>
<h1 id="toc4"><span>Stepper</span></h1>
<div class="image-container aligncenter"><a href="https://www.flickr.com/photos/arthurwolf/6249350300/"><img src="https://farm7.static.flickr.com/6034/6249350300_b53acde8ed_b.jpg" alt="flickr:6249350300" class="image" /></a></div>
<p>So the first, most important loop in the Stepper module is the stepping loop. It is the one that actually makes the stepper motor move. It also if necessary gets a new Block from the Planner's queue when it has finished stepping the previous one.</p>
<p>This is the very speed-critical part of Smoothie : everything is done using integer math, and the speed here determines the maximum speed at which the robot can move. At the time of this writing, Smoothie is comfortable with stepping speeds of up to 110kHz, which is much higher than what most uses require.</p>
<p>The other loop is the acceleration loop. The work of the Planner is done for this loop :&nbsp;depending on where we are inside the current Block/line segment, it raises or lowers the current stepping speed ( the speed of the previous loop ), thus accelerating or decelerating.</p>
<p>If any of this is not clear enough or if you need precisions, please don't hesitate to <a href="mailto:wolf.arthur@gmail.com">contact</a>.</p>
</div>
          
          <div style="height:150px"></div>
          <div class="page-info-break"></div>
          <div class="page-options-container"><div id="page-info">page revision: 8, last edited: <span class="odate time_1412375060 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%20%28%25O%20ago%29">03 Oct 2014 22:24</span></div>
            <div id="page-options-bottom"  class="page-options-bottom">
            <a href="javascript:;" class="btn btn-default" id="edit-button">Edit</a>
<a href="javascript:;" class="btn btn-default" id="tags-button">Tags</a>

<a href="javascript:;" class="btn btn-default" id="history-button">History</a>
<a href="javascript:;" class="btn btn-default" id="files-button">Files</a>
<a href="javascript:;" class="btn btn-default" id="print-button">Print</a>
<a href="javascript:;" class="btn btn-default" id="site-tools-button">Site tools</a>
<a href="javascript:;" class="btn btn-default" id="more-options-button">+&nbsp;Options</a> 
</div>
<div id="page-options-bottom-2" class="page-options-bottom form-actions" style="display:none">
    <a href="javascript:;" class="btn btn-default" id="edit-sections-button">Edit Sections</a>
    <a href="javascript:;" class="btn btn-default" id="edit-append-button">Append</a>
    <a href="javascript:;" class="btn btn-default" id="edit-meta-button">Edit Meta</a>
    <a href="javascript:;" class="btn btn-default" id="watchers-button">Watchers</a> 
    <a href="javascript:;" class="btn btn-default" id="backlinks-button">Backlinks</a> 
    <a href="javascript:;" class="btn btn-default" id="view-source-button">Page Source</a> 
    <a href="javascript:;" class="btn btn-default" id="parent-page-button">Parent</a> 
    <a href="javascript:;" class="btn btn-default" id="page-block-button">Lock Page</a>    
    <a href="javascript:;" class="btn btn-default" id="rename-move-button">Rename</a> 
    <a href="javascript:;" class="btn btn-default" id="delete-button">Delete</a> 
</div>
<div id="page-options-area-bottom">
</div>
</div>
          <div id="action-area" style="display: none;"></div>
        </div>
      </div>
    </div>
  </div>
</main>
 
<footer class="footer-wrap" role="contentinfo">
  <div class="container footer">
    <div class="options" style="display: block; visibility: visible;">
    <a href="http://www.wikidot.com/doc" id="wikidot-help-button">Help</a>
    &nbsp;|
    <a href="legal_terms-of-service.html" id="wikidot-tos-button">Terms of Service</a>
    &nbsp;|
    <a href="legal_privacy-policy.html" id="wikidot-privacy-button">Privacy</a>
    &nbsp;|
    <a href="javascript:;" id="bug-report-button" onclick="WIKIDOT.page.listeners.pageBugReport(event)">Report a bug</a>
    &nbsp;|
    <a href="javascript:;" id="abuse-report-button" onclick="WIKIDOT.page.listeners.flagPageObjectionable(event)">Flag as objectionable</a>
</div>
Powered by <a href="index-4.html">Wikidot.com</a> 
    <div class="license-area">Unless otherwise stated, the content of this page is licensed under <a rel="license" href="index-5.html">Creative Commons Attribution-ShareAlike 3.0 License</a></div>
  </div>
  <div class="extrac-div-1"><span></span></div>
  <div class="extrac-div-2"><span></span></div>
  <div class="extrac-div-3"><span></span></div>
</footer>
 

</div> <!-- container-wrap -->
 
<div class="extra-div-1"><span></span></div>
<div class="extra-div-2"><span></span></div>
<div class="extra-div-3"><span></span></div>
<div class="extra-div-4"><span></span></div>
<div class="extra-div-5"><span></span></div>
<div class="extra-div-6"><span></span></div>
</div> <!-- container-wrap-wrap -->
</div>
<div id="dummy-ondomready-block" style="display: none;" ></div>
    <!-- Google Analytics load -->
    <script type="text/javascript">
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

    <!-- Quantcast -->
    <script type="text/javascript">
    _qoptions={
        qacct:"p-edL3gsnUjJzw-"
    };
    (function() {
        var qc = document.createElement('script'); qc.type = 'text/javascript'; qc.async = true;
        qc.src = ('https:' == document.location.protocol ? 'https://secure' : 'http://edge') + '.quantserve.com/quant.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(qc, s);
    })();
    </script>
    <noscript>
        <img src="../images/p-edl3gsnujjzw-.gif" style="display: none;" border="0" height="1" width="1" alt="Quantcast"/>
    </noscript>




<div id="page-options-bottom-tips" style="display: none;">
    <div id="edit-button-hovertip">
        Click here to edit contents of this page.    </div>
</div>
<div id="page-options-bottom-2-tips"  style="display: none;">
    <div id="edit-sections-button-hovertip">
        Click here to toggle editing of individual sections of the page (if possible).         Watch headings for an &quot;edit&quot; link when available.    </div>
    <div id="edit-append-button-hovertip">
        Append content without editing the whole page source.    </div>
    <div id="history-button-hovertip">
        Check out how this page has evolved in the past.    </div>
    <div id="discuss-button-hovertip">
        If you want to discuss contents of this page - this is the easiest way to do it.    </div>
    <div id="files-button-hovertip">
        View and manage file attachments for this page.    </div>
    <div id="site-tools-button-hovertip">
        A few useful tools to manage this Site.    </div>
    <div id="backlinks-button-hovertip">
        See pages that link to and include this page.    </div>
    <div id="rename-move-button-hovertip">
        Change the name (also URL address, possibly the category) of the page.    </div>
    <div id="view-source-button-hovertip">
        View wiki source for this page without editing.    </div>
    <div id="parent-page-button-hovertip">  
        View/set parent page (used for creating breadcrumbs and structured layout).    </div>
            <div id="abuse-report-button-hovertip">
            Notify administrators if there is objectionable content in this page.        </div>
        <div id="bug-report-button-hovertip">
            Something does not work as expected? Find out what you can do.        </div>
        <div id="wikidot-help-button-hovertip">
            General Wikidot.com documentation and help section.        </div>
        <div id="wikidot-tos-button-hovertip">
            Wikidot.com Terms of Service - what you can, what you should not etc.        </div>
        <div id="wikidot-privacy-button-hovertip">
            Wikidot.com Privacy Policy.          
        </div>
    </div>
</body>

<!-- Mirrored from smoothieware.org/howitworks by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 May 2016 11:57:39 GMT -->
</html>